<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zifo ESG Proxy Engine - Scope 3 Emissions</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body class="bg-slate-50 text-slate-900 font-sans p-6">
    <div id="root">
        <p class="text-center text-slate-500 mt-20 font-semibold animate-pulse">Initializing Global ESG Engine...</p>
    </div>

    <script type="text/babel">
        const { useState, useMemo, useRef, useEffect } = React;

        // TRANSPARENTE EMISSIONSFAKTOREN
        const FACTORS = {
            commute: { car: 0.19, motorbike: 0.11, rickshaw: 0.09, metro: 0.03, bus_shuttle: 0.05 },
            travel: { 
                train: 0.04, // pro km
                flight_short: 150, // pro Flug
                flight_long: 1000, // pro interkontinentalem Flug
                hotel_night: 30 // pro Nacht
            },
            hardware: { 
                yearly_laptop_cloud: 150 // kgCO2e pro FTE/Jahr f√ºr Hardware-Abschreibung & SaaS
            }
        };
        const COLORS = ['#0f172a', '#3b82f6', '#10b981'];

        function SimpleBarChart({ data }) {
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            useEffect(() => {
                if (chartRef.current && data) {
                    if (chartInstance.current) chartInstance.current.destroy();
                    const ctx = chartRef.current.getContext('2d');
                    chartInstance.current = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: data.map(d => d.name),
                            datasets: [{
                                label: 'Emissions (tCO‚ÇÇe)',
                                data: data.map(d => d.value),
                                backgroundColor: COLORS,
                                borderRadius: 4
                            }]
                        },
                        options: {
                            indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: { x: { beginAtZero: true } }
                        }
                    });
                }
                return () => { if (chartInstance.current) chartInstance.current.destroy(); };
            }, [data]);
            return <canvas ref={chartRef}></canvas>;
        }

        function App() {
            // REGIONALE FTE STEUERUNG (Slider States)
            const [indiaFTE, setIndiaFTE] = useState(2000);
            const [euFTE, setEuFTE] = useState(180);
            const [usFTE, setUsFTE] = useState(50);
            
            // INDIEN COMMUTING
            const [indiaSplit, setIndiaSplit] = useState({ car: 5, motorbike: 35, rickshaw: 20, metro: 10, shuttle: 30 });
            
            // BUSINESS TRAVEL
            const [personas, setPersonas] = useState({ sales: 20, delivery: 160 });
            const [globalTrips, setGlobalTrips] = useState(15);
            
            // REGIONALE EVENTS
            const [euEvent, setEuEvent] = useState(true);
            const [usEvent, setUsEvent] = useState(false);

            const calculations = useMemo(() => {
                const totalFTE = indiaFTE + euFTE + usFTE;

                // SCOPE 3.1: PURCHASED GOODS (Transparenter Proxy pro FTE)
                const scope31_Total = (totalFTE * FACTORS.hardware.yearly_laptop_cloud) / 1000;

                // SCOPE 3.7: COMMUTING (Nur Indien Delivery Center)
                const indiaDays = 240, indiaKmPerDay = 30;
                const indiaTotalKm = indiaFTE * indiaDays * indiaKmPerDay;
                const indEmissions = ['car', 'motorbike', 'rickshaw', 'metro'].reduce((acc, mode) => 
                    acc + (indiaSplit[mode] / 100) * indiaTotalKm * FACTORS.commute[mode], 
                0) + (indiaSplit.shuttle / 100) * indiaTotalKm * FACTORS.commute.bus_shuttle;
                const scope37_Total = indEmissions / 1000;

                // SCOPE 3.6: BUSINESS TRAVEL
                // 1. Dynamische Ratio: Wie viele der westlichen FTEs sitzen in der EU vs. USA?
                const westernFTE = euFTE + usFTE || 1; // "|| 1" verhindert einen Error bei 0
                const euRatio = euFTE / westernFTE;
                const usRatio = usFTE / westernFTE;

                // 2. Regionale Baseline-Multiplikatoren (inklusive Hoteln√§chte)
                // EU: Zug-fokussiert, 5 Kurzstreckenfl√ºge, Mietwagen, 20 Hoteln√§chte
                const euSalesMultiplier = (5000 * FACTORS.travel.train) + (2000 * FACTORS.commute.car) + (5 * FACTORS.travel.flight_short) + (20 * FACTORS.travel.hotel_night);

                // US: Flug-fokussiert (30 Kurzstreckenfl√ºge), Mietwagen, 40 Hoteln√§chte (0 Zug)
                const usSalesMultiplier = (30 * FACTORS.travel.flight_short) + (2000 * FACTORS.commute.car) + (40 * FACTORS.travel.hotel_night);

                // 3. Gewichteter Sales-Durchschnitt auf das einzelne Input-Feld angewendet
                const salesEmissions = personas.sales * ((euRatio * euSalesMultiplier) + (usRatio * usSalesMultiplier));

                const deliveryEmissions = personas.delivery * (2000 * FACTORS.travel.train);
                const globalEmissions = globalTrips * (FACTORS.travel.flight_long + (4 * FACTORS.travel.hotel_night));
                
                // Dynamische Event-Kalkulation basierend auf FTEs der Region
                // EU Event: 1 Kurzstreckenflug + 2 N√§chte Hotel pro Kopf
                const euEventEmissions = euEvent ? euFTE * (FACTORS.travel.flight_short + (2 * FACTORS.travel.hotel_night)) : 0;
                // US Event: 1 Kurzstreckenflug + 2 N√§chte Hotel pro Kopf (USA ist fluglastiger)
                const usEventEmissions = usEvent ? usFTE * (FACTORS.travel.flight_short + (2 * FACTORS.travel.hotel_night)) : 0;
                
                const scope36_Total = (salesEmissions + deliveryEmissions + globalEmissions + euEventEmissions + usEventEmissions) / 1000;

                const totalEmissions = scope37_Total + scope36_Total + scope31_Total;

                return {
                    totalFTE, scope31: scope31_Total, scope36: scope36_Total, scope37: scope37_Total, total: totalEmissions,
                    chartData: [
                        { name: 'Purchased Goods (3.1)', value: Math.round(scope31_Total) },
                        { name: 'Business Travel (3.6)', value: Math.round(scope36_Total) },
                        { name: 'Commuting India (3.7)', value: Math.round(scope37_Total) }
                    ]
                };
            }, [indiaFTE, euFTE, usFTE, indiaSplit, personas, globalTrips, euEvent, usEvent]);

            const handleIndiaSplit = (mode, val) => setIndiaSplit(prev => ({ ...prev, [mode]: Number(val) }));
            const splitTotal = Object.values(indiaSplit).reduce((a, b) => a + b, 0);

            return (
                <div className="max-w-6xl mx-auto pb-10">
                    <div className="flex justify-between items-center border-b border-slate-300 pb-4 mb-8">
                        <div>
                            <h1 className="text-3xl font-bold text-slate-900">Zifo ESG Proxy Engine</h1>
                            <p className="text-sm text-slate-500 font-medium">Global Scope3 Footprint</p>
                        </div>
                        <div className="text-right">
                            <div className="text-4xl font-extrabold text-blue-600">{Math.round(calculations.total)} <span className="text-lg text-slate-500 font-medium">tCO‚ÇÇe</span></div>
                            <p className="text-xs font-semibold uppercase text-slate-400">Total Enterprise Footprint</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        {/* LEFT COLUMN: INPUTS */}
                        <div className="space-y-6">
                            
                            {/* REGIONALE FTE STEUERUNG */}
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <div className="flex justify-between items-end mb-4">
                                    <h2 className="text-lg font-bold">üåç Global Headcount (FTEs)</h2>
                                    <span className="text-sm font-bold bg-blue-100 text-blue-800 px-2 py-1 rounded">Total: {calculations.totalFTE}</span>
                                </div>
                                <div className="space-y-4">
                                    <div>
                                        <div className="flex justify-between text-sm mb-1"><span className="font-medium">India (Chennai HQ)</span><span className="font-bold">{indiaFTE}</span></div>
                                        <input type="range" min="0" max="5000" step="50" value={indiaFTE} onChange={(e) => setIndiaFTE(Number(e.target.value))} className="w-full" />
                                    </div>
                                    <div>
                                        <div className="flex justify-between text-sm mb-1"><span className="font-medium">Europe (Remote First)</span><span className="font-bold">{euFTE}</span></div>
                                        <input type="range" min="0" max="1000" step="10" value={euFTE} onChange={(e) => setEuFTE(Number(e.target.value))} className="w-full" />
                                    </div>
                                    <div>
                                        <div className="flex justify-between text-sm mb-1"><span className="font-medium">USA (Remote First)</span><span className="font-bold">{usFTE}</span></div>
                                        <input type="range" min="0" max="1000" step="10" value={usFTE} onChange={(e) => setUsFTE(Number(e.target.value))} className="w-full" />
                                    </div>
                                </div>
                            </div>

                            {/* SCOPE 3.1 TRANSPARENZ */}
                            <div className="bg-slate-50 p-6 rounded-xl shadow-inner border border-slate-200">
                                <h2 className="text-sm font-bold text-slate-700 mb-2 uppercase tracking-wide">üíª Scope 3.1: Purchased Goods Basis</h2>
                                <p className="text-xs text-slate-600">
                                    Calculated as a fixed proxy of <strong>{FACTORS.hardware.yearly_laptop_cloud} kg CO‚ÇÇe per FTE/year</strong>. 
                                    This covers the annualized lifecycle emissions of standard IT hardware (Laptop, Monitor) and essential SaaS cloud infrastructure allocations.
                                </p>
                            </div>

                            {/* BUSINESS TRAVEL & EVENTS */}
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <h2 className="text-lg font-bold mb-4">‚úàÔ∏è Business Travel & Events (Scope 3.6)</h2>
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center">
                                        <label className="text-sm font-medium">Sales Personas (High Travel)</label>
                                        <input type="number" value={personas.sales} onChange={(e) => setPersonas({...personas, sales: Number(e.target.value)})} className="p-2 border rounded w-24 text-right" />
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <label className="text-sm font-medium">Delivery Personas (Low Travel)</label>
                                        <input type="number" value={personas.delivery} onChange={(e) => setPersonas({...personas, delivery: Number(e.target.value)})} className="p-2 border rounded w-24 text-right" />
                                    </div>
                                    <div className="flex justify-between items-center border-b pb-4">
                                        <label className="text-sm font-medium">Global Intercontinental Trips Internal</label>
                                        <input type="number" value={globalTrips} onChange={(e) => setGlobalTrips(Number(e.target.value))} className="p-2 border rounded w-24 text-right" />
                                    </div>
                                    
                                    <h3 className="text-sm font-bold text-slate-700 mt-4 mb-2">Regional All-Hands Events</h3>
                                    <div className="flex justify-between items-center bg-slate-50 p-2 rounded">
                                        <label className="text-sm font-medium">European Event ({euFTE} Pax)</label>
                                        <input type="checkbox" checked={euEvent} onChange={(e) => setEuEvent(e.target.checked)} className="w-5 h-5 accent-blue-600" />
                                    </div>
                                    <div className="flex justify-between items-center bg-slate-50 p-2 rounded">
                                        <label className="text-sm font-medium">US Event ({usFTE} Pax)</label>
                                        <input type="checkbox" checked={usEvent} onChange={(e) => setUsEvent(e.target.checked)} className="w-5 h-5 accent-blue-600" />
                                    </div>
                                </div>
                            </div>

                        </div>

                        {/* RIGHT COLUMN: OUTPUTS & COMMUTING */}
                        <div className="space-y-6">
                            
                            {/* INDIA COMMUTING */}
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <h2 className="text-lg font-bold mb-4">üìç Chennai Commuting (Scope 3.7)</h2>
                                <p className="text-xs text-slate-500 mb-4">Scope 3.7 is strictly calculated for the {indiaFTE} office-based India FTEs. EU/US remote work emissions fall under Scope 1/2 facility energy.</p>
                                <div className="space-y-3">
                                    {Object.entries(indiaSplit).map(([mode, val]) => (
                                        <div key={mode} className="flex items-center justify-between">
                                            <label className="text-sm font-medium capitalize w-24">{mode.replace('_', ' ')}</label>
                                            <input type="range" min="0" max="100" value={val} onChange={(e) => handleIndiaSplit(mode, e.target.value)} className="w-full mx-4" />
                                            <span className="text-sm font-bold w-12 text-right">{val}%</span>
                                        </div>
                                    ))}
                                </div>
                                {splitTotal !== 100 && <p className="text-red-500 text-xs mt-3 font-bold">Warning: Total is {splitTotal}%. Adjust to 100%.</p>}
                            </div>

                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <h2 className="text-lg font-bold mb-4">üìä EcoVadis Export Summary</h2>
                                <table className="w-full text-left border-collapse">
                                    <thead>
                                        <tr className="border-b-2 text-xs uppercase text-slate-500"><th className="py-2">Category</th><th className="py-2 text-right">tCO‚ÇÇe</th></tr>
                                    </thead>
                                    <tbody className="text-sm">
                                        <tr className="border-b"><td className="py-3">Scope 3.1 - Purchased Goods & IT</td><td className="py-3 font-semibold text-right">{Math.round(calculations.scope31).toLocaleString()}</td></tr>
                                        <tr className="border-b"><td className="py-3">Scope 3.6 - Business Travel</td><td className="py-3 font-semibold text-right">{Math.round(calculations.scope36).toLocaleString()}</td></tr>
                                        <tr><td className="py-3">Scope 3.7 - Commuting (India)</td><td className="py-3 font-semibold text-right">{Math.round(calculations.scope37).toLocaleString()}</td></tr>
                                    </tbody>
                                </table>
                            </div>

                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200 h-64">
                                <SimpleBarChart data={calculations.chartData} />
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
